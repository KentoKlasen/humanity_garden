pico-8 cartridge // http://www.pico-8.com
version 32
__lua__
--humanitygarden by kentoklasen

-- [ main / utils ] --


function _init()
 init_plr()
 init_plants()
 draw=draw_game
 update=update_plr
end

function _draw()
 draw()
end

function _update()
 update()
 update_plants()
end

function draw_game()
 cls(8)
 draw_plants()
 draw_plr()
end
-->8
-- [ player / controls ] --

function init_plr()
	plr=
	{dir=4,
	x=8,y=8,
	spd=1,
	anim="idle",
	t=0,
	working=false,
	}
	
	timer=
	{start_time=0,
	length=0,
	action=false
	}
	
	-- ⬅️➡️⬆️⬇️
	anim_repo=	
	{ idle={1,1,3,2}
	, run ={6,6,8,4}
	, --place holder sprites
	water={18,18,18,18}
	}
end

function draw_plr()
 map()
	palt(0,false)
	palt(1,true)
	local frame=anim_repo[plr.anim][plr.dir]
	if plr.anim=="run" then
	 local plr_anim_speed=12
		frame+=(plr.t+plr_anim_speed)/plr_anim_speed%2
	end
	spr(frame
	,plr.x,plr.y,1,1,plr.dir==1)
	palt()
end

function update_plr()
	plr.t+=1
	check_timer()
	-- ⬅️➡️⬆️⬇️
	if is_on_cell() and
				plr.working==false then
 	handle_movement_input() 
 elseif plr.anim=="run" then
	 --go to next cell 
 	--add to plr x or y
 	if plr.dir==1 then
	 	plr.x-=plr.spd 
 	elseif	plr.dir==2 then
 	 plr.x+=plr.spd 
 	elseif plr.dir==3 then
 	 plr.y-=plr.spd
 	elseif plr.dir==4 then
 	 plr.y+=plr.spd
 	end
	end
end

--returns: boolean
function is_on_cell()
 return plr.x%8==0 and plr.y%8==0
end

function handle_movement_input()
	if btn(❎) then --water anim
	 plr.anim="water"
	 plr.working=true
	 start_work_timer(45,end_work)
	elseif btn(⬆️) and plr.y>=8 then
	 plr.anim="run"
	 plr.dir=3 
	 plr.y-=plr.spd 
	elseif btn(➡️) and plr.x<=112 then
	 plr.anim="run"
  plr.dir=2
	 plr.x+=plr.spd
 elseif btn(⬇️) and plr.y<=112 then
	 plr.anim="run"
	 plr.dir=4
	 plr.y+=plr.spd
	elseif btn(⬅️) and plr.x>=8 then
	 plr.anim="run"
	 plr.dir=1
	 plr.x-=plr.spd
	else
		plr.anim="idle"
		plr.t=0
	end
end

function check_timer()
	if timer.start_time+timer.length<plr.t
	   and  timer.action~=false then
	   	timer.action()
	   	timer.action=false
    end
end

function start_work_timer(timer_len,action_function)
	timer.start_time=plr.t
 timer.length=timer_len
 timer.action=action_function	
end

function end_work()
		plr.anim="idle"
		plr.t=0
		plr.working=false
end

-->8
--plants

function init_plants()
 plants={}
 add_plant(16,16)
 add_plant(16,24)
 add_plant(16,32)
end

function add_plant(_x,_y)
 local plant={
  x=_x,
  y=_y,
  state=0,
  picked=0,
  t=0}
 add(plants,plant)
end

function draw_plants()
 for plant in all(plants) do
   spr(10+plant.state,plant.x,plant.y)
 end
end

function update_plants()
	for plant in all(plants) do
	 plant.t+=flr(rnd(8))
	 	--todo change later 
	 if plant.t>450 then 
 	 plant.t=0
 	 
	  if plant.state<2 then
	  	plant.state+=1
 	 end
  end 
	end
end
__gfx__
000000001114411111144111111441111114411111144111111144111111441111144111111441110000000000000000000b0000000000000000000000000000
0000000011444411114444111144441111444411114444111114444111144441114444111144441100000000000000000033b000000000000000000000000000
00700700177777111777777117777771177777711777777111777771117777711777777117777771000000000000000003333b00000000000000000000000000
0007700017770711170770711777777117077071170770711177707111777071177777711777777100300000000b000000333000000000000000000000000000
00077000177e77111e7777e1177777711e7777e11e7777e11177e7711177e77117777771177777710000000000bb0000000b0000000000000000000000000000
0070070011373111133334311333333173333437733334371113731111137311733333377333333700000300003b300000030000000000000000000000000000
00000000113331111733337117333371113333111133331111733361116333711163331111333611000300000000000000000000000000000000000000000000
00000000111611111161161111611611111116111161111111111111111111111111161111611111000000000000000000000000000000000000000000000000
000000000000000077000007000000000000000000000000000000000000000000000000000000000000000000000000770bb000000000000000000000000000
00000000000000000070077700000000000000000000000000000000000000000000000000000000000000000000300077b00b00000000000000000000000000
000000000000000000077700000000000000000000000000000000000000000000000000000000000000000000030300000b0770000000000000000000000000
000000000000000000077770000000000000000000000000000000000000000000000000000000000000000000b0000000770770000000000000000000000000
0000000000000000077000070000000000000000000000000000000000000000000000000000000000f000000003000000770000000000000000000000000000
0000000000000000770000000000000000000000000000000000000000000000000000000000000000000f00000f000000ff0000000000000000000000000000
00000000000000007000000000000000000000000000000000000000000000000000000000000000000f00000000000000000000000000000000000000000000
__map__
0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a00000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a00000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a00000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a00000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a00000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a00000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a00000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
